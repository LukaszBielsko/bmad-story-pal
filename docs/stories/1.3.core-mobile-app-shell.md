# Story 1.3: Core Mobile App Shell

## Status
Superseded - Split into 1.3a and 1.3b

**⚠️ STORY SUPERSEDED:** This story has been split into two focused stories based on Product Owner review:
- **Story 1.3a:** Basic App Infrastructure (PostCSS, dependencies, navigation)  
- **Story 1.3b:** Welcome Screen & Design System (UI components, user validation)

**Reason for Split:** Scope too large and risky for single story. Split reduces technical risk and enables incremental delivery.

## Story

**As a** parent,
**I want** to open the StoryMagic app and see a welcoming interface,
**so that** I feel confident using it during bedtime routines.

## Acceptance Criteria

1. React Native navigation structure implemented (React Navigation)
2. Welcome screen with clean, bedtime-appropriate design
3. Basic app loading states and error boundaries
4. App icons and splash screen configured for iOS and Android
5. Core design system components implemented (buttons, cards, typography)
6. App successfully builds and runs on both iOS and Android devices

## Tasks / Subtasks

- [ ] Task 1: Fix PostCSS Configuration Issues (AC: 6)
  - [ ] Create proper `postcss.config.js` file with TailwindCSS and Autoprefixer support
  - [ ] Configure NativeWind integration correctly to avoid async plugin errors
  - [ ] Test PostCSS configuration with a simple styled component
  
- [ ] Task 2: Resolve Dependency Version Conflicts (AC: 6)
  - [ ] Update React Native to compatible version (avoid React 19 conflicts)
  - [ ] Ensure Metro bundler dependencies are consistent
  - [ ] Fix monorepo workspace dependency resolution
  - [ ] Clean node_modules and reinstall dependencies in correct order
  
- [ ] Task 3: Implement Safe Area Provider Setup (AC: 1, 2)
  - [ ] Configure single SafeAreaProvider at app root level
  - [ ] Create reusable SafeAreaView component in `src/components/common/SafeAreaView.tsx`
  - [ ] Avoid duplicate SafeAreaProvider instances in navigation components
  
- [ ] Task 4: Create Core Navigation Structure (AC: 1)
  - [ ] Implement AppNavigator.tsx as root navigation container
  - [ ] Set up AuthNavigator.tsx for authentication flow (placeholder)
  - [ ] Create MainTabNavigator.tsx for authenticated app navigation
  - [ ] Test navigation flow without circular dependencies
  
- [ ] Task 5: Build Welcome Screen (AC: 2, 5)
  - [ ] Create WelcomeScreen.tsx in `src/screens/auth/` directory
  - [ ] Implement bedtime-appropriate design with design system components
  - [ ] Add welcome message and basic navigation elements
  - [ ] Use only components that are fully implemented (avoid Button dependency issues)
  
- [ ] Task 6: Implement Core Design System Components (AC: 5)
  - [ ] Create basic Button component in `src/components/common/Button.tsx`
  - [ ] Build Card component for content display
  - [ ] Implement Typography components for text consistency
  - [ ] Add LoadingSpinner for loading states
  - [ ] Test each component in isolation before integration
  
- [ ] Task 7: Configure App Loading States and Error Boundaries (AC: 3)
  - [ ] Create ErrorBoundary component for React error handling
  - [ ] Implement LoadingScreen for app initialization
  - [ ] Add error handling for navigation failures
  - [ ] Test error scenarios and recovery flows
  
- [ ] Task 8: Set up App Icons and Splash Screen (AC: 4)
  - [ ] Configure app.json with basic app metadata
  - [ ] Add placeholder app icons for iOS and Android
  - [ ] Set up basic splash screen configuration
  - [ ] Test app launch sequence on both platforms

## Dev Notes

### Previous Story Problems Analysis
**Critical Technical Issues from Story 1.3 Problems Document:**
- PostCSS async plugin configuration causing app crashes
- Metro bundler dependency conflicts with mixed versions
- React Native bridge callback errors from duplicate SafeAreaProvider
- Monorepo React version conflicts (18.2.0 vs 19+)
- Component dependency chains not fully resolved

### Technical Architecture Context

#### Technology Stack Requirements [Source: architecture/tech-stack.md]
- **Frontend:** React Native 0.72+ with TypeScript
- **State Management:** Redux Toolkit (deferred for this story)
- **Navigation:** React Navigation for app flow
- **Styling:** NativeWind/TailwindCSS integration (fix PostCSS issues)
- **Build:** Metro bundler (resolve dependency conflicts)

#### Project Structure Standards [Source: architecture/source-tree.md]
```
apps/mobile/src/
├── navigation/          # Navigation components
│   ├── AppNavigator.tsx
│   ├── AuthNavigator.tsx
│   └── MainTabNavigator.tsx
├── screens/auth/        # Authentication screens
│   └── WelcomeScreen.tsx
├── components/common/   # Reusable UI components
│   ├── Button.tsx
│   ├── Card.tsx
│   ├── SafeAreaView.tsx
│   └── LoadingSpinner.tsx
```

#### Component Architecture Standards [Source: architecture/frontend.md]
- **Safe Area Management:** Single SafeAreaProvider at app root
- **Navigation Flow:** AppNavigator → AuthNavigator → WelcomeScreen
- **Component Structure:** Props interface, hooks first, event handlers, early returns
- **Error Handling:** ErrorBoundary for React errors, proper cleanup

#### Development Environment Requirements [Source: architecture/coding-standards.md]
- **TypeScript:** Strict mode enabled, explicit typing required
- **File Naming:** PascalCase for components, camelCase for utilities
- **Import Pattern:** Named imports preferred, relative imports for local files
- **Component Props:** Interface definitions with optional prop handling

### Critical Implementation Guidelines

1. **PostCSS Configuration** - MUST create proper `postcss.config.js` before any styling work
2. **Dependency Management** - Clean install in apps/mobile directory, avoid React 19 
3. **SafeAreaProvider** - Only ONE provider at app root, reusable wrapper component
4. **Component Dependencies** - Build bottom-up, test each component before integration
5. **Metro Configuration** - Use exact versions, avoid mixed dependency versions
6. **Navigation Setup** - Implement basic structure without complex flows initially

### File Creation Priority
1. `postcss.config.js` - Fix styling configuration
2. `src/components/common/SafeAreaView.tsx` - Safe area wrapper
3. `src/components/common/Button.tsx` - Basic button component
4. `src/navigation/AppNavigator.tsx` - Root navigation
5. `src/screens/auth/WelcomeScreen.tsx` - Welcome screen
6. `App.tsx` - Root app component with single SafeAreaProvider

### Testing Requirements [Source: architecture/coding-standards.md]
- **Manual Testing Phase:** Component validation through direct testing
- **Error Scenarios:** Test navigation failures and component error states
- **Platform Testing:** iOS and Android compatibility verification
- **Build Validation:** Successful Metro bundling and app startup

### Project Structure Notes
File paths align with defined mobile app structure. No conflicts identified between epic requirements and architecture documentation.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-25 | 1.0 | Initial story creation with comprehensive technical context | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*Results from QA Agent review will be added here after implementation*